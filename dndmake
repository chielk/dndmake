#!/usr/bin/env python3
# dndmake - generate a random NPC with height, weight according to D&D, hair
# and eye colour, and a personality based on
# http://en.wikipedia.org/wiki/Big_Five_personality_traits
# (c) Chiel Kooijman 2014

DNDMAKE_VERSION = "0.1"

import argparse
import sys
import os
import random
import dndraces
try:
    import pyperclip
except ImportError:
    pyperclip = None


def parse_arguments():
    """Parse command-line arguments."""

    descr = """Generate a D&D character with a gender and a height and weight
    based on the gender. Furthermore they have a hair and eye colour and a
    personality based on the five-factor model (FFM), which influences their
    alignment. Gender, height, weight and alignment can also be influenced or
    forced through arguments."""

    parser = argparse.ArgumentParser(description=descr)

    gender = parser.add_mutually_exclusive_group()
    gender.add_argument("-m", "--male", action="store_const", const="male",
                        dest="gender", help="Make a male character")
    gender.add_argument("-f", "--female", action="store_const", const="female",
                        dest="gender", help="Make a female character")

    height = parser.add_mutually_exclusive_group()
    height.add_argument("-t", "--tall", action="store_const", const="tall",
                        dest="height", help="Make a tall character")
    height.add_argument("-s", "--short", action="store_const", const="short",
                        dest="height", help="Make a short character")

    weight = parser.add_mutually_exclusive_group()
    weight.add_argument("-b", "--heavy", action="store_const", const="heavy",
                        dest="weight", help="Make a heavy character")
    weight.add_argument("-l", "--light", action="store_const", const="light",
                        dest="weight", help="Make a light character")

    parser.add_argument("race", default=None, choices=dndraces.list_races(),
                        nargs='?', help="e.g. human, elf")

    parser.add_argument("-a", "--alignment", choices=dndraces.Race.ALIGNMENTS,
                        default=None,
                        help="Lawfulness and goodness: [LNC][GNE]")
    parser.add_argument("-n", "--name", help="Character name")
    parser.add_argument("-v", "--version", action='store_true',
                        help="Print version")
    args = parser.parse_args()

    if not args.race:
        args.race = random.choice(dndraces.list_races())

    return args


if __name__ == "__main__":
    args = parse_arguments()
    if args.version:
        print('dndmake {}'.format(DNDMAKE_VERSION))
        sys.exit(0)
    try:
        Race = dndraces.load_race(args.race)
    except FileNotFoundError:
        print("Unknown race:", args.race, file=sys.stderr)
        sys.exit(1)

    character = Race(name=args.name, gender=args.gender, height=args.height,
                     weight=args.weight, alignment=args.alignment)
    if pyperclip:
        pyperclip.copy(character.__str__())

    print(character)
